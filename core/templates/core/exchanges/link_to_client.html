{% extends "core/base.html" %}

{% block title %}Link Exchange to Client Â· Broker Portal{% endblock %}
{% block page_title %}Link Exchange to {{ client.name }}{% endblock %}
{% block page_subtitle %}Configure exchange percentages for {{ client.name }}{% if client.code %} ({{ client.code }}){% endif %}{% endblock %}

{% block content %}
<div style="background: var(--bg-content); border-radius: 8px; padding: 24px; border: 1px solid var(--border); max-width: 600px;">
    <form method="post">
        {% csrf_token %}
        <div class="form-row">
            <label class="field-label">Select Exchange *</label>
            <select name="exchange" id="exchange-select" class="field-input" required>
                <option value="">Choose an exchange</option>
                {% for exchange in exchanges %}
                    <option value="{{ exchange.pk }}">{{ exchange.name }}{% if exchange.code %} ({{ exchange.code }}){% endif %}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-row">
            <label class="field-label">My Share % (Your share of profits) *</label>
            <input type="number" name="my_share_pct" id="my-share-input" class="field-input" step="0.01" min="0" max="100" required placeholder="e.g., 10.00" oninput="validateCompanyShare()">
            <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">Your percentage share of profits</div>
        </div>
        
        <div class="form-row">
            <label class="field-label">Company Share % (From your profit) *</label>
            <input type="number" name="company_share_pct" id="company-share-input" class="field-input" step="0.01" min="0" max="100" required placeholder="e.g., 5.00" oninput="validateCompanyShare()">
            <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">Must be less than your share</div>
            <div id="validation-message" style="font-size: 12px; color: var(--danger); margin-top: 4px; display: none;"></div>
            {% if error %}
                <div style="font-size: 12px; color: var(--danger); margin-top: 4px;">{{ error }}</div>
            {% endif %}
        </div>
        
        <div class="form-row">
            <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" name="is_active" checked>
                <span class="field-label" style="margin: 0;">Active</span>
            </label>
        </div>
        
        <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button type="submit" class="btn btn-primary" id="submit-btn">Link Exchange</button>
            <a href="{% url 'clients:detail' client.pk %}" class="btn">Cancel</a>
        </div>
    </form>
</div>

<script>
function validateCompanyShare() {
    const myShare = parseFloat(document.getElementById('my-share-input').value) || 0;
    const companyShare = parseFloat(document.getElementById('company-share-input').value) || 0;
    const messageDiv = document.getElementById('validation-message');
    const submitBtn = document.getElementById('submit-btn');
    
    if (companyShare > 0 && myShare > 0) {
        if (companyShare >= myShare) {
            messageDiv.textContent = 'Company share must be less than your share';
            messageDiv.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.5';
        } else {
            messageDiv.style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
        }
    } else {
        messageDiv.style.display = 'none';
        submitBtn.disabled = false;
        submitBtn.style.opacity = '1';
    }
}
</script>
{% endblock %}

